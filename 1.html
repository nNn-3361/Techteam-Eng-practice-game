<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Engineer English Training Suite</title>
    <style>
        :root {
            --bg-color: #0d1117; 
            --panel-bg: #161b22;
            --text-color: #c9d1d9;
            --accent-color: #58a6ff;
            --success-color: #238636;
            --warning-color: #d29922;
            --error-color: #da3633;
            --border-color: #30363d;
            --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            min-height: 100vh;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .btn {
            cursor: pointer; font-family: var(--font-mono); border: none; outline: none;
            transition: all 0.2s;
        }
        .btn:active { transform: scale(0.98); }

        /* --- HOME DASHBOARD STYLES --- */
        #home-view {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
        }

        .hub-title {
            font-family: var(--font-mono); font-size: 1.5rem; color: var(--accent-color);
            margin-bottom: 10px; letter-spacing: -1px;
        }
        .hub-subtitle { color: #8b949e; margin-bottom: 40px; font-size: 0.9rem; }

        .module-grid {
            display: grid; grid-template-columns: 1fr; gap: 20px;
            width: 100%; max-width: 500px;
        }

        .module-card {
            background-color: var(--panel-bg); border: 1px solid var(--border-color);
            padding: 25px; border-radius: 12px; text-align: left;
            cursor: pointer; position: relative; overflow: hidden;
            transition: border-color 0.2s, transform 0.2s;
        }
        .module-card:hover { border-color: var(--accent-color); transform: translateY(-2px); }
        
        .card-icon { font-size: 2rem; margin-bottom: 15px; display: block; }
        .card-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; color: #fff; }
        .card-desc { font-size: 0.85rem; color: #8b949e; line-height: 1.5; }
        
        .card-badge {
            position: absolute; top: 15px; right: 15px;
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px;
            font-family: var(--font-mono); font-weight: bold;
        }
        .badge-rpg { background: rgba(88, 166, 255, 0.2); color: var(--accent-color); }
        .badge-parser { background: rgba(35, 134, 54, 0.2); color: var(--success-color); }

        /* --- SHARED HEADER --- */
        .game-header {
            background-color: #010409; padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 50;
        }
        .home-btn {
            background: transparent; color: #8b949e; border: 1px solid var(--border-color);
            padding: 5px 10px; border-radius: 6px; font-size: 0.8rem;
        }
        .home-btn:hover { color: #fff; border-color: #fff; }
        .header-center { font-family: var(--font-mono); font-weight: bold; font-size: 0.9rem; }
        .header-score { font-family: var(--font-mono); color: var(--success-color); }

        /* --- RPG STYLES --- */
        #rpg-view { width: 100%; max-width: 600px; margin: 0 auto; flex-grow: 1; display: flex; flex-direction: column; }
        .rpg-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        
        .npc-box {
            background: #21262d; border-left: 4px solid var(--accent-color);
            padding: 20px; margin-bottom: 20px; border-radius: 0 8px 8px 0;
        }
        .npc-name { color: var(--accent-color); font-size: 0.75rem; font-weight: bold; margin-bottom: 8px; text-transform: uppercase; }
        .npc-text { font-size: 1.1rem; line-height: 1.5; }

        .opt-btn {
            width: 100%; background: var(--panel-bg); border: 1px solid var(--border-color);
            color: var(--text-color); padding: 15px; margin-bottom: 10px;
            text-align: left; border-radius: 8px; font-size: 0.95rem; display: flex;
        }
        .opt-btn:hover { border-color: #8b949e; }
        .opt-tag { font-family: var(--font-mono); color: #666; margin-right: 10px; width: 15px; }

        /* --- PARSER STYLES --- */
        #parser-view { width: 100%; max-width: 600px; margin: 0 auto; flex-grow: 1; display: flex; flex-direction: column; height: 100vh; }
        .parser-area { flex-grow: 1; overflow-y: auto; padding: 20px 10px; background: #161b22; }
        
        .msg-row { display: flex; margin-bottom: 15px; animation: popIn 0.3s forwards; }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .avatar {
            width: 35px; height: 35px; border-radius: 50%; display: flex; 
            justify-content: center; align-items: center; font-weight: bold; 
            margin-right: 10px; flex-shrink: 0; font-size: 0.8rem; color: #fff;
        }
        .av-pm { background: #e57373; } .av-dev { background: #58a6ff; } .av-client { background: #f0883e; }

        .bubble {
            background: #21262d; padding: 10px 15px; border-radius: 4px 16px 16px 16px;
            max-width: 85%; font-size: 0.95rem; line-height: 1.4; border: 2px solid transparent; cursor: pointer;
            position: relative;
        }
        .bubble.selected { border-color: var(--accent-color); background: #30363d; }
        .bubble.correct { border-color: var(--success-color); background: rgba(35, 134, 54, 0.1); }
        .bubble.missed { border-color: var(--warning-color); opacity: 0.6; }
        .bubble.wrong { border-color: var(--error-color); opacity: 0.6; }

        .parser-controls { padding: 15px; background: #0d1117; border-top: 1px solid var(--border-color); }
        .commit-btn {
            width: 100%; background: var(--success-color); color: white; padding: 15px;
            border-radius: 8px; font-weight: bold; font-size: 1rem;
        }
        .commit-btn:disabled { background: #30363d; color: #8b949e; }

        /* --- OVERLAYS --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; text-align: center;
        }
        .fb-box {
            background: var(--panel-bg); border: 1px solid var(--border-color);
            padding: 25px; border-radius: 12px; max-width: 400px; width: 100%; text-align: left;
        }
        .next-btn {
            background: var(--accent-color); color: #000; padding: 12px 25px;
            border-radius: 6px; font-weight: bold; margin-top: 20px; width: 100%;
        }
        
        .context-bar { 
            text-align: center; font-size: 0.75rem; color: #8b949e; 
            font-family: var(--font-mono); margin-bottom: 15px; border-bottom: 1px solid #30363d; padding-bottom: 5px;
        }
    </style>
</head>
<body>

    <div id="home-view">
        <div class="hub-title">&lt;ENG_TRAINING_HUB /&gt;</div>
        <div class="hub-subtitle">Select a training module to begin</div>

        <div class="module-grid">
            <div class="module-card" onclick="startRPG()">
                <div class="card-badge badge-rpg">SPEAKING</div>
                <span class="card-icon">üí¨</span>
                <div class="card-title">The Meeting RPG</div>
                <div class="card-desc">
                    Ê®°Êì¨È´òÂ£ìÊúÉË≠∞ÊÉÖÂ¢É„ÄÇË®ìÁ∑¥Ë™ûÁî®ÔºàPragmaticsÔºâ„ÄÅÊãíÁµïÈúÄÊ±Ç„ÄÅËàáËß£ÈáãÊäÄË°ìÂïèÈ°åÁöÑËÉΩÂäõ„ÄÇ
                </div>
            </div>

            <div class="module-card" onclick="startParser()">
                <div class="card-badge badge-parser">LISTENING</div>
                <span class="card-icon">üìù</span>
                <div class="card-title">The Log Parser</div>
                <div class="card-desc">
                    Ê®°Êì¨Âç≥ÊôÇÈÄöË®äÁ¥ÄÈåÑ„ÄÇË®ìÁ∑¥ÂæûÈõúË®ä‰∏≠ÁØ©ÈÅ∏Âá∫ Action Items„ÄÅDeadline ËàáÊ±∫Á≠ñÈáçÈªû„ÄÇ
                </div>
            </div>
        </div>
    </div>

    <div id="rpg-view" class="hidden">
        <header class="game-header">
            <button class="btn home-btn" onclick="goHome()">üè† Home</button>
            <div class="header-center">MEETING_RPG_v3</div>
            <div class="header-score">XP: <span id="rpg-score-display">0</span></div>
        </header>

        <div class="rpg-content" id="rpg-game-area">
            <div id="rpg-badge-area" style="margin-bottom:10px;"></div>
            <div class="terminal-text" id="rpg-context" style="color:#8b949e; font-size:0.8rem; margin-bottom:10px;"></div>
            
            <div class="npc-box">
                <div class="npc-name" id="rpg-npc-name"></div>
                <div class="npc-text" id="rpg-npc-text"></div>
            </div>

            <div id="rpg-options" style="margin-top:auto;"></div>
        </div>

        <div id="rpg-end-overlay" class="overlay hidden">
            <h1 style="color:var(--accent-color)">Simulation Complete</h1>
            <div style="font-size:3rem; font-family:var(--font-mono); color:var(--success-color); margin:10px 0;" id="rpg-final-score">0</div>
            <p id="rpg-final-msg" style="color:#8b949e; line-height:1.5; max-width:300px;"></p>
            <button class="btn next-btn" onclick="startRPG()">Replay Module</button>
            <button class="btn home-btn" style="margin-top:15px; width:auto; border:none;" onclick="goHome()">Back to Dashboard</button>
        </div>
    </div>

    <div id="rpg-feedback-overlay" class="overlay hidden">
        <div class="fb-box">
            <div id="rpg-fb-title" style="font-weight:bold; font-size:1.2rem; margin-bottom:10px;"></div>
            <div id="rpg-fb-content" style="color:#c9d1d9; line-height:1.5; font-size:0.95rem;"></div>
            <button class="btn next-btn" onclick="nextRPGLevel()">Next >></button>
        </div>
    </div>


    <div id="parser-view" class="hidden">
        <header class="game-header">
            <button class="btn home-btn" onclick="goHome()">üè† Home</button>
            <div class="header-center">LOG_PARSER</div>
            <div class="header-score">Score: <span id="parser-score-display">0</span></div>
        </header>

        <div class="parser-area" id="parser-chat-area">
            </div>

        <div class="parser-controls">
            <button id="parser-commit-btn" class="btn commit-btn" onclick="checkParserWave()">Commit Log</button>
        </div>

        <div id="parser-end-overlay" class="overlay hidden">
            <h1 style="color:var(--success-color)">Log Saved</h1>
            <div style="font-size:3rem; font-family:var(--font-mono); color:#fff; margin:10px 0;" id="parser-final-score">0</div>
            <p id="parser-final-msg" style="color:#8b949e; line-height:1.5; max-width:300px;"></p>
            <button class="btn next-btn" onclick="startParser()">Next Meeting</button>
            <button class="btn home-btn" style="margin-top:15px; width:auto; border:none;" onclick="goHome()">Back to Dashboard</button>
        </div>
    </div>

    <script>
        // ================= GLOBAL NAVIGATION =================
        function goHome() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('rpg-view').classList.add('hidden');
            document.getElementById('parser-view').classList.add('hidden');
            
            // Optional: Hide overlays if open
            document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
        }

        // ================= MODULE 1: RPG LOGIC =================
        const rpgData = [
            // Simplified pool for demo length (You can add the full 30 here)
            { diff: 1, npc: "Senior_Dev", context: "Code Review", text: "Rename 'x' to 'userTimestamp'. 'x' is meaningless.", opts: [
                { t: "Fine.", type: "passive", a: "‚ö†Ô∏è Too Passive. ÂñÆÂ≠óÂõûÁ≠îÈ°ØÂæó‰∏çÊÉÖÈ°ò„ÄÇ" },
                { t: "Whatever, it works.", type: "aggressive", a: "üö´ Aggressive. Â∞ç Code Quality Â±ïÁèæ‰∏çÂ±ëÊòØÂ§ßÂøå„ÄÇ" },
                { t: "Good catch. I'll update it.", type: "pragmatic", a: "‚úÖ Constructive. Ê≠£Èù¢Êé•ÂèóÂª∫Ë≠∞„ÄÇ" }
            ]},
            { diff: 2, npc: "PM", context: "Scope Creep", text: "Can we add this feature by Friday?", opts: [
                { t: "No. Impossible.", type: "aggressive", a: "üö´ Too Blunt. Â§™ÂÉµÂåñÔºåÊú™Êèê‰æõÁ∑©Ë°ù„ÄÇ" },
                { t: "It might risk the QA timeline. Should we prioritize this over bug fixes?", type: "pragmatic", a: "‚úÖ Trade-off. ÈªûÂá∫ÂæåÊûú‰∏¶‰∫§ÈÇÑÊ±∫Á≠ñÊ¨ä„ÄÇ" },
                { t: "I'll try.", type: "passive", a: "‚ö†Ô∏è Risky. ÊâøË´æÊú™Áü•È¢®Èö™ÊòØÂç±Èö™ÁöÑ„ÄÇ" }
            ]},
            { diff: 3, npc: "CEO", context: "System Down", text: "We are losing money! Fix it!", opts: [
                { t: "Stop yelling!", type: "aggressive", a: "üö´ Suicide. Âè´ËÄÅÈóÜÈñâÂò¥ÈÄöÂ∏∏ÊÑèÂë≥ËëóÂ§±Ê•≠„ÄÇ" },
                { t: "Identified the issue. Rolling back now. Back in 5 mins.", type: "pragmatic", a: "‚úÖ Crisis Comms. ÁôºÁèæÂïèÈ°å -> Ë°åÂãï -> È†êË®àÊôÇÈñì„ÄÇ" },
                { t: "The DB had a race condition.", type: "passive", a: "‚ö†Ô∏è TMI. ËÄÅÈóÜÁèæÂú®Âè™Ë¶ÅÁü•ÈÅì‰ΩïÊôÇ‰øÆÂ•Ω„ÄÇ" }
            ]},
            // ... Feel free to paste the full 30 questions from previous chat here ...
        ];

        let rpgState = { path: [], step: 0, score: 0 };

        function startRPG() {
            // Setup View
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('rpg-view').classList.remove('hidden');
            document.getElementById('rpg-end-overlay').classList.add('hidden');
            
            // Init State (Pick 5 random for demo, or 10)
            const pool = [...rpgData, ...rpgData, ...rpgData]; // Duplicating for demo length if pool is small
            rpgState.path = pool.sort(() => 0.5 - Math.random()).slice(0, 5); 
            rpgState.step = 0;
            rpgState.score = 0;
            
            updateRPGUI();
            loadRPGLevel();
        }

        function updateRPGUI() {
            document.getElementById('rpg-score-display').innerText = rpgState.score;
        }

        function loadRPGLevel() {
            if (rpgState.step >= rpgState.path.length) {
                endRPG();
                return;
            }
            const data = rpgState.path[rpgState.step];
            
            // Render content
            document.getElementById('rpg-badge-area').innerHTML = `<span style="background:#30363d; padding:2px 6px; border-radius:4px; font-size:0.7rem;">LV ${data.diff}</span>`;
            document.getElementById('rpg-context').innerText = `// ${data.context}`;
            document.getElementById('rpg-npc-name').innerText = data.npc;
            document.getElementById('rpg-npc-text').innerText = data.text;
            
            const optContainer = document.getElementById('rpg-options');
            optContainer.innerHTML = '';
            
            // Randomize options
            const shuffledOpts = [...data.opts].sort(() => 0.5 - Math.random());
            shuffledOpts.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'btn opt-btn';
                btn.innerHTML = `<span class="opt-tag">${['A','B','C'][idx]}</span> ${opt.t}`;
                btn.onclick = () => handleRPGChoice(opt);
                optContainer.appendChild(btn);
            });
        }

        function handleRPGChoice(opt) {
            let title, color;
            if (opt.type === 'pragmatic') {
                rpgState.score += 100;
                title = "COMPILE SUCCESS"; color = "var(--success-color)";
            } else if (opt.type === 'passive') {
                rpgState.score += 40;
                title = "WARNING: Passive Voice"; color = "var(--warning-color)";
            } else {
                title = "RUNTIME ERROR"; color = "var(--error-color)";
            }
            
            // Show Feedback
            const overlay = document.getElementById('rpg-feedback-overlay');
            document.getElementById('rpg-fb-title').innerText = title;
            document.getElementById('rpg-fb-title').style.color = color;
            document.getElementById('rpg-fb-content').innerText = opt.a;
            overlay.classList.remove('hidden');
        }

        function nextRPGLevel() {
            document.getElementById('rpg-feedback-overlay').classList.add('hidden');
            rpgState.step++;
            updateRPGUI();
            loadRPGLevel();
        }

        function endRPG() {
            document.getElementById('rpg-end-overlay').classList.remove('hidden');
            document.getElementById('rpg-final-score').innerText = rpgState.score;
            let msg = "Keep practicing!";
            if(rpgState.score >= rpgState.path.length * 90) msg = "CTO Level! Excellent.";
            else if(rpgState.score >= rpgState.path.length * 60) msg = "Senior Level. Good job.";
            document.getElementById('rpg-final-msg').innerText = msg;
        }

        // ================= MODULE 2: PARSER LOGIC =================
        const parserData = [
            { ctx: "Daily Stand-up", msgs: [
                { r: "pm", n: "PM", t: "Morning all!", imp: false },
                { r: "dev", n: "Dev", t: "I'm blocked by the DB timeout.", imp: true },
                { r: "dev", n: "Dev", t: "Still working on API.", imp: false }
            ]},
            { ctx: "Client Meeting", msgs: [
                { r: "client", n: "Client", t: "I love the blue color.", imp: false },
                { r: "client", n: "Client", t: "We need PDF export by Friday.", imp: true },
                { r: "pm", n: "PM", t: "We will try.", imp: false }
            ]},
            { ctx: "Tech Sync", msgs: [
                { r: "lead", n: "Lead", t: "Let's deprecate v1 API.", imp: true },
                { r: "jun", n: "Jun", t: "Wait, really?", imp: false },
                { r: "lead", n: "Lead", t: "Yes, update docs today.", imp: true }
            ]}
        ];

        let parserState = { idx: 0, score: 0, selected: new Set(), checking: false };

        function startParser() {
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('parser-view').classList.remove('hidden');
            document.getElementById('parser-end-overlay').classList.add('hidden');
            
            parserState.idx = 0;
            parserState.score = 0;
            updateParserUI();
            loadParserWave();
        }

        function updateParserUI() {
            document.getElementById('parser-score-display').innerText = parserState.score;
        }

        function loadParserWave() {
            if (parserState.idx >= parserData.length) {
                endParser();
                return;
            }
            const data = parserData[parserState.idx];
            parserState.selected.clear();
            parserState.checking = false;
            document.getElementById('parser-commit-btn').disabled = false;
            document.getElementById('parser-commit-btn').innerText = "Commit Log";

            const area = document.getElementById('parser-chat-area');
            area.innerHTML = `<div class="context-bar">-- ${data.ctx} --</div>`;
            
            data.msgs.forEach((m, i) => {
                const row = document.createElement('div');
                row.className = 'msg-row';
                
                const av = document.createElement('div');
                av.className = `avatar av-${m.r === 'pm' ? 'pm' : (m.r === 'client' ? 'client' : 'dev')}`;
                av.innerText = m.n[0];
                
                const bub = document.createElement('div');
                bub.className = 'bubble';
                bub.innerText = m.t;
                bub.onclick = () => {
                    if(parserState.checking) return;
                    if(parserState.selected.has(i)) {
                        parserState.selected.delete(i);
                        bub.classList.remove('selected');
                    } else {
                        parserState.selected.add(i);
                        bub.classList.add('selected');
                    }
                };
                
                row.append(av, bub);
                area.append(row);
            });
        }

        function checkParserWave() {
            parserState.checking = true;
            document.getElementById('parser-commit-btn').disabled = true;
            
            const data = parserData[parserState.idx];
            const bubbles = document.querySelectorAll('.parser-area .bubble');
            let waveScore = 0;

            data.msgs.forEach((m, i) => {
                const isSel = parserState.selected.has(i);
                if (m.imp) {
                    if (isSel) { bubbles[i].classList.add('correct'); waveScore += 100; }
                    else { bubbles[i].classList.add('missed'); bubbles[i].style.border = "1px dashed #d29922"; }
                } else {
                    if (isSel) { bubbles[i].classList.add('wrong'); waveScore -= 50; }
                }
            });

            parserState.score += Math.max(0, waveScore);
            updateParserUI();

            setTimeout(() => {
                parserState.idx++;
                loadParserWave();
            }, 2000);
        }

        function endParser() {
            document.getElementById('parser-end-overlay').classList.remove('hidden');
            document.getElementById('parser-final-score').innerText = parserState.score;
            document.getElementById('parser-final-msg').innerText = "Meeting notes saved successfully.";
        }

    </script>
</body>
</html>